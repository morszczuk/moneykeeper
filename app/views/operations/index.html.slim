.row
  .col-md-12
    .x_panel
      .x_title
        h2 Wgrane transakcje
        .clearfix
      .x_content
        table.table.table-striped
          colgroup
            col.w/
            col.w/
            col/
            col/
          thead
            th Data operacji
            th Kwota
            th Tytuł
            th Części płatności
          tbody
            - @operations.each do |operation|
              tr
                .row
                  td
                    = operation.order_date
                  td
                    = operation.amount
                    = operation.currency
                  - if operation.parts_amount_valid?
                    td
                      = operation.description
                  - else
                    td.red
                      = operation.description
                  td
                    .x_content
                      - operation.payment_parts.each do |pp|
                        .row
                          .col.md-10
                            /! start accordion
                            .panel
                              #accordion.accordion aria-multiselectable="true" role="tablist" 
                                = tag.a class:"panel-heading collapsed", role: "tab", id: "heading-#{pp.id}", "data-toggle": "collapse", "data-parent": "#accordion", href: "#collapse-#{pp.id}", "aria-expanded": "false", "aria-controls": "collapseOne" do
                                  h4.panel-title
                                    = pp.amount
                                    = operation.currency
                                    = pp.category.name
                                = tag.div id: "collapse-#{pp.id}", class: "panel-collapse collapse", role: "tabpanel", "aria-labelledby": "heading-#{pp.id}", "aria-expanded": "false", style: "height: 0px;" do
                                  .panel-body
                                    = form_for(pp, url: payment_part_path(pp), method: :patch, html: {class: 'form-horizontal'}) do |pp_edit|
                                      .form-group
                                        .col-md-12
                                          = pp_edit.collection_select(:category_id, Category.all, :id, :name, {}, {class: 'form-control select2_single'})
                                      .form-group
                                        .col-md-12
                                          = pp_edit.text_field :labels, { class: 'form-control', placeholder: 'Labels' }
                                      .form-group
                                        .col-md-12
                                          = pp_edit.submit class: 'btn btn-success'
                            /! end of accordion
                          .col.md-2
                            = link_to operation_payment_part_path(operation, pp), { method: :delete , class: "btn btn-danger" } do
                              i.fa.fa-close
                      .panel
                        #accordion.accordion aria-multiselectable="true" role="tablist" 
                          = tag.a class:"panel-heading collapsed", role: "tab", id: "heading-#{operation.id}-new", "data-toggle": "collapse", "data-parent": "#accordion", href: "#collapse-#{operation.id}-new", "aria-expanded": "false", "aria-controls": "collapseOne" do
                            h4.panel-title
                              span.glyphicon.glyphicon-plus aria-hidden="true" 
                              | New part
                          = tag.div id: "collapse-#{operation.id}-new", class: "panel-collapse collapse", role: "tabpanel", "aria-labelledby": "heading-#{operation.id}-new", "aria-expanded": "false", style: "height: 0px;" do
                            .panel-body
                              = form_for(PaymentPart.new, url: operation_payment_parts_path(operation), method: :post, html: {class: 'form-horizontal'}) do |pp_edit|
                                .form-group
                                  .col-md-12
                                    = pp_edit.text_field :amount, step: 0.01
                                    = operation.currency
                                .form-group
                                  .col-md-12
                                    = pp_edit.collection_select(:category_id, Category.all, :id, :name, {}, {class: 'form-control select2_single'})
                                .form-group
                                  .col-md-12
                                    = pp_edit.text_field :labels, { class: 'form-control', placeholder: 'Labels' }
                                .form-group
                                  .col-md-12
                                    = pp_edit.submit class: 'btn btn-success'
h1
  | Wgranych transakcji: #{@operations.count}
= link_to "Usuń  wszystkie operacje", :delete_all_operations
